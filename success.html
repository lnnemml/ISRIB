<!doctype html>
<html lang="en">
<head>

  <script src="/scripts/gtm.js" async></script>
  <!-- Reddit Pixel -->
  <script src="/scripts/reddit-pixel.js"></script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Thank you ‚Äî ISRIB.shop</title>
  <meta name="robots" content="noindex,follow"/>
  <meta name="description" content="Thank you for your request. We'll reply shortly with payment and shipping details.">

  <!-- Canonical / Open Graph -->
  <link rel="canonical" href="https://isrib.shop/success.html"/>
  <meta property="og:title" content="Thank you ‚Äî ISRIB.shop"/>
  <meta property="og:description" content="We received your request and will get back to you shortly."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://isrib.shop/success.html"/>
  <meta property="og:image" content="images/og-cover.jpg"/>
  <!-- Favicon & App Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/images/site.webmanifest">
<link rel="shortcut icon" href="/images/favicon.ico">
<meta name="theme-color" content="#ffffff">


  <link rel="stylesheet" href="css/styles.css?v=19"/>
  <style>
    .success-hero{background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);padding:60px 0 40px;text-align:center;position:relative}
    .success-hero::before{content:'';position:absolute;inset:0;background:
      radial-gradient(circle at 18% 82%, rgba(30,64,175,.10) 0%, transparent 50%),
      radial-gradient(circle at 84% 18%, rgba(14,165,233,.10) 0%, transparent 50%)}
    .success-hero .title{position:relative;z-index:1;font-weight:900;font-size:clamp(2.1rem,4.5vw,3.2rem);color:#1e293b;margin:0 0 10px}
    .success-hero .sub{position:relative;z-index:1;color:#64748b;font-size:1.05rem;max-width:760px;margin:0 auto}
    .success-section{padding:28px 0 70px}.success-section .container{max-width:820px}
    .lead{opacity:.9}.req-summary h2{font-size:1.1rem;margin:0 0 .75rem}.req-summary ul{list-style:none;padding:0;margin:0}
    .next-steps ol{margin:0;padding-left:1.25rem}
  </style>
</head>
<body>

<header class="header-slim site-header" id="siteHeader">
  <div class="container">
    <div class="header-content">
      <a href="/" class="logo-slim" aria-label="ISRIB.shop home">
        <img src="images/logo-dark-trimmed.png" alt="ISRIB.shop Logo" class="logo-image-slim"/>
      </a>
      <nav class="nav-slim" aria-label="Primary">
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
        <a href="checkout.html" class="cart-btn-slim" id="cartBtn">üß∫ <span>Cart</span> <span id="cartCount" class="badge-slim">0</span></a>
      </nav>
      <div class="mobile-actions">
        <a href="checkout.html" class="cart-btn-mobile" id="cartBtnMobile" aria-label="View cart">üß∫ <span id="cartCountMobileBtn" class="badge-mobile">0</span></a>
        <button class="burger" id="burgerBtn" aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
          <svg class="burger-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
            <path d="M4 7h16M4 12h16M10 17h10"/>
          </svg>
        </button>
      </div>
      <nav class="mobile-menu" id="mobileMenu" data-nav aria-label="Mobile">
        <a href="products.html" class="mm-link">Products</a>
        <a href="about.html" class="mm-link">About</a>
        <a href="faq.html" class="mm-link">FAQ</a>
        <a href="contact.html" class="mm-link">Contact</a>
      </nav>
    </div>
  </div>
</header>

<section class="success-hero">
  <div class="container">
    <h1 class="title">Thank you! üéâ</h1>
    <p class="sub">We've received your request. We'll reply shortly with payment & shipping instructions.</p>
  </div>
</section>

<main class="success-section">
  <div class="container">
    <section class="card">
      <div class="card-body">
        <div id="summary" class="card req-summary" style="margin:1rem 0 1.25rem; display:none;">
          <div class="card-body">
            <h2>Request summary</h2>
            
            <!-- –¢–∞–±–ª–∏—Ü—è —Ç–æ–≤–∞—Ä—ñ–≤ -->
            <table style="width:100%; border-collapse:collapse; margin-bottom:1rem;">
              <thead>
                <tr style="border-bottom:1px solid #e5e7eb;">
                  <th style="text-align:left; padding:0.5rem;">Product</th>
                  <th style="text-align:center; padding:0.5rem;">Pack</th>
                  <th style="text-align:center; padding:0.5rem;">Packs</th>
                  <th style="text-align:right; padding:0.5rem;">Price</th>
                </tr>
              </thead>
              <tbody id="s-items-tbody">
                <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ JS -->
              </tbody>
            </table>

            <hr class="sep" style="margin:0.85rem 0;">
            <div class="sum-line"><span>Subtotal</span> <b id="s-subtotal">‚Äî</b></div>
            <div id="s-discount-line" style="display:none;" class="sum-line">
              <span>Discount (<span id="s-promo-code"></span>)</span>
              <b id="s-discount" style="color:#10b981;">‚Äî</b>
            </div>
            <div class="sum-line"><span>Shipping</span> <b>FREE</b></div>
            <div class="sum-line grand"><span>Total</span> <b id="s-total">‚Äî</b></div>
            <div class="sum-note" style="color:#64748b;margin-top:.35rem;">* Free shipping ‚Äî limited-time launch offer.</div>
          </div>
        </div>

        <div class="back-actions" style="display:flex;justify-content:center;gap:.75rem;flex-wrap:wrap;margin-top:.5rem;">
          <a class="btn" href="index.html" onclick="trackCTA?.('success','home')">Home</a>
          <a class="btn btn-secondary" href="products.html" onclick="trackCTA?.('success','products')">Catalog</a>
          <a class="btn btn-outline" href="contact.html" onclick="trackCTA?.('success','contact')">Send another request</a>
        </div>

        <hr class="sep" style="margin:1.5rem 0;">

        <div class="next-steps">
          <h2 style="font-size:1.05rem;margin-bottom:.5rem;">What's next?</h2>
          <ol>
            <li>Check your email ‚Äî you'll get our reply soon.</li>
            <li>If you don't see our message, check the Spam folder or contact us again.</li>
          </ol>
        </div>
      </div>
    </section>
  </div>
</main>

 <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ISRIB Shop</h3>
          <p>Advanced research chemicals for scientific advancement. Trusted by researchers worldwide for quality and reliability.</p>
          <p><strong>Email:</strong> isrib.shop@protonmail.com</p>
        </div>
        <div class="footer-section">
          <h3>Products</h3>
          <ul>
            <li><a href="product_isrib_A15.html">ISRIB-A15</a></li>
            <li><a href="product_isrib.html">ISRIB Original</a></li>
            <li><a href="product_zzl_7.html">ZZL-7</a></li>
            <li><a href="product_MPEP.html">MPEP Oxalate</a></li>
            <li><a href="products.html">All Products</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Information</h3>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="quality.html">Quality Control</a></li>
            <li><a href="safety.html">Safety Guidelines</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Legal</h3>
          <ul>
            <li><a href="terms.html">Terms of Service</a></li>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="research.html">Research Use Only</a></li>
            <li><a href="disclaimer.html">Disclaimer</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ISRIB Shop. All rights reserved. | Research chemicals for laboratory use only.</p>
      </div>
    </div>
  </footer>

<!-- App JS -->
<script src="js/main.js?v=34"></script>

<!-- ============================================ -->
<!-- ‚úÖ SUCCESS PAGE –°–ö–†–ò–ü–¢ –ó REDDIT PIXEL       -->
<!-- ============================================ -->
<script>
(function() {
  console.log('[SUCCESS] üöÄ Script started');
  
  // ============================================
  // UTILITY FUNCTIONS
  // ============================================
  function fmtUSD(n) {
    return '$' + (Number(n || 0)).toFixed(2);
  }
  
  function parseQtyToMgLabel(s) {
    const t = String(s || '').toLowerCase();
    const n = parseFloat(t.replace(/[^0-9.]/g, '')) || 0;
    return t.includes('g') && !t.includes('mg') ? Math.round(n * 1000) : Math.round(n);
  }
  
  // ============================================
  // ‚úÖ –û–¢–†–ò–ú–ê–ù–ù–Ø ORDER ID
  // ============================================
  function getOrderId() {
    console.log('[SUCCESS] üîç Getting Order ID...');
    
    // –°–ø—Ä–æ–±–∞ 1: –∑ localStorage order data (–ü–†–Ü–û–†–ò–¢–ï–¢!)
    try {
      const orderData = JSON.parse(localStorage.getItem('_order_success_data') || '{}');
      if (orderData.order_id) {
        console.log('[SUCCESS] ‚úÖ Order ID from order data:', orderData.order_id);
        return orderData.order_id;
      }
    } catch(e) {
      console.warn('[SUCCESS] ‚ö†Ô∏è Cannot parse order data:', e);
    }
    
    // –°–ø—Ä–æ–±–∞ 2: –∑ sessionStorage
    try {
      const stored = sessionStorage.getItem('_order_id');
      if (stored) {
        console.log('[SUCCESS] ‚úÖ Order ID from session:', stored);
        return stored;
      }
    } catch(e) {
      console.warn('[SUCCESS] ‚ö†Ô∏è Cannot read sessionStorage:', e);
    }
    
    // –°–ø—Ä–æ–±–∞ 3: –∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
    const urlParams = new URLSearchParams(window.location.search);
    const oid = urlParams.get('oid');
    if (oid) {
      console.log('[SUCCESS] ‚úÖ Order ID from URL:', oid);
      return oid;
    }
    
    // –°–ø—Ä–æ–±–∞ 4: —à—É–∫–∞—î–º–æ –≤ pending orders
    try {
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('pending_order_')) {
          const data = JSON.parse(localStorage.getItem(key) || '{}');
          if (data.checkout_submitted_at) {
            const age = Date.now() - data.checkout_submitted_at;
            if (age < 2 * 60 * 1000) { // –º–æ–ª–æ–¥—à–µ 2 —Ö–≤–∏–ª–∏–Ω
              console.log('[SUCCESS] ‚úÖ Order ID from recent pending:', data.order_id);
              return data.order_id;
            }
          }
        }
      }
    } catch(e) {
      console.warn('[SUCCESS] ‚ö†Ô∏è Cannot search pending orders:', e);
    }
    
    // Fallback
    const fallbackId = 'ORD-' + Date.now() + '-' + Math.random().toString(36).substring(2, 9).toUpperCase();
    console.warn('[SUCCESS] ‚ö†Ô∏è Using fallback Order ID:', fallbackId);
    return fallbackId;
  }
  
  const ORDER_ID = getOrderId();
  console.log('[SUCCESS] üÜî Final Order ID:', ORDER_ID);
  
  // Transaction ID –¥–ª—è GA4
  let TRANSACTION_ID = ORDER_ID;
  try {
    const txnStored = sessionStorage.getItem('_txn_id');
    if (txnStored) {
      TRANSACTION_ID = txnStored;
      console.log('[SUCCESS] üìã Transaction ID:', TRANSACTION_ID);
    }
  } catch(e) {}
  
  // ============================================
  // –ß–ò–¢–ê–ù–ù–Ø –î–ê–ù–ò–• –ó–ê–ú–û–í–õ–ï–ù–ù–Ø
  // ============================================
  let orderData = null;
  
  try {
    const stored = localStorage.getItem('_order_success_data');
    console.log('[SUCCESS] üì¶ LocalStorage:', stored ? 'Found' : 'Empty');
    
    if (stored) {
      orderData = JSON.parse(stored);
      console.log('[SUCCESS] ‚úÖ Order data loaded:', {
        orderId: orderData.order_id,
        total: orderData.total,
        items: orderData.items?.length,
        timestamp: orderData.timestamp
      });
      
      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—ñ (–Ω–µ —Å—Ç–∞—Ä—à–µ 5 —Ö–≤–∏–ª–∏–Ω)
      const age = Date.now() - (orderData.timestamp || 0);
      if (age > 5 * 60 * 1000) {
        console.warn('[SUCCESS] ‚ö†Ô∏è Order data expired (age: ' + Math.round(age/1000) + 's)');
        orderData = null;
      }
      
      console.log('[SUCCESS] üìå Keeping order data for now');
    }
  } catch (e) {
    console.error('[SUCCESS] ‚ùå Parse error:', e);
  }
  
  // Fallback: sessionStorage
  if (!orderData) {
    try {
      const stored = sessionStorage.getItem('_order_success_data');
      if (stored) {
        orderData = JSON.parse(stored);
        sessionStorage.removeItem('_order_success_data');
        console.log('[SUCCESS] ‚úÖ Loaded from sessionStorage');
      }
    } catch (e) {
      console.warn('[SUCCESS] ‚ö†Ô∏è SessionStorage fallback failed:', e);
    }
  }
  
  // Fallback: URL params
  if (!orderData) {
    const q = new URLSearchParams(location.search);
    const oid = q.get('oid');
    const t = q.get('t');
    
    if (oid && t) {
      console.warn('[SUCCESS] ‚ö†Ô∏è Using URL fallback');
      orderData = {
        order_id: oid,
        total: parseFloat(t) || 0,
        subtotal: parseFloat(t) || 0,
        discount: 0,
        promo: '',
        items: [{
          name: 'Order',
          sku: 'backup',
          qty: 1,
          price: parseFloat(t) || 0,
          display: ''
        }],
        timestamp: Date.now()
      };
    }
  }
  
  // ============================================
  // –Ø–ö–©–û –ù–ï–ú–ê–Ñ –î–ê–ù–ò–•
  // ============================================
  if (!orderData || !orderData.items || orderData.items.length === 0) {
    console.error('[SUCCESS] ‚ùå No order data available');
    
    const box = document.getElementById('summary');
    if (box) {
      box.style.display = 'block';
      box.innerHTML = `
        <div style="text-align:center;padding:2rem;">
          <p style="color:#ef4444;font-size:1.1rem;margin-bottom:1rem;">
            ‚ö†Ô∏è Unable to load order details
          </p>
          <p style="color:#64748b;">
            Your order was submitted successfully.<br>
            Check your email for confirmation.
          </p>
        </div>
      `;
    }
    
    return;
  }
  
  const { order_id, subtotal, discount, promo, total, items } = orderData;
  
  console.log('[SUCCESS] üìä Order summary:', {
    orderId: order_id || ORDER_ID,
    total: total,
    items: items.length,
    discount: discount,
    promo: promo
  });
  
  // ============================================
  // –†–ï–ù–î–ï–†–ò–ú–û UI
  // ============================================
  const box = document.getElementById('summary');
  if (box) box.style.display = 'block';
  
  const tbody = document.getElementById('s-items-tbody');
  if (tbody) {
    tbody.innerHTML = items.map(item => `
      <tr style="border-bottom:1px solid #f3f4f6;">
        <td style="padding:0.5rem;">${item.name || 'Product'}</td>
        <td style="text-align:center; padding:0.5rem;">${item.display || ''}</td>
        <td style="text-align:center; padding:0.5rem;">${item.qty || 1}</td>
        <td style="text-align:right; padding:0.5rem;">${fmtUSD(item.price)}</td>
      </tr>
    `).join('');
  }
  
  const set = (id, val) => { 
    const el = document.getElementById(id); 
    if (el) el.textContent = val; 
  };
  
  set('s-subtotal', fmtUSD(subtotal));
  set('s-total', fmtUSD(total));
  
  // Discount row
  if (discount > 0 && promo) {
    const discountLine = document.getElementById('s-discount-line');
    if (discountLine) {
      discountLine.style.display = 'flex';
      set('s-promo-code', promo);
      set('s-discount', '‚àí' + fmtUSD(discount));
    }
  }

  // ============================================
  // ‚úÖ GA4 + REDDIT PIXEL EVENT: BUY_INTENT
  // ============================================
  function sendBuyIntent() {
    console.log('[SUCCESS] üéØ Preparing buy_intent event...');
    
    if (!items || items.length === 0) {
      console.warn('[SUCCESS] ‚ö†Ô∏è No items for buy_intent');
      return;
    }
    
    if (!total || total <= 0) {
      console.warn('[SUCCESS] ‚ö†Ô∏è Invalid total for buy_intent:', total);
      return;
    }
    
    try {
      // Prepare items for GA4
      const ga4Items = items.map(item => ({
        item_id: item.sku || 'unknown',
        item_name: item.name || 'Unknown Product',
        item_variant: item.display || '',
        item_category: 'Research Compounds',
        quantity: Number(item.qty) || 1,
        price: Number(item.price) || 0
      }));

      console.log('[SUCCESS] üì¶ Items prepared:', ga4Items);

      // ============================================
      // ‚úÖ GA4 EVENT: buy_intent
      // ============================================
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        event: 'buy_intent',
        ecommerce: {
          currency: 'USD',
          value: total,
          items: ga4Items
        },
        transaction_id: TRANSACTION_ID,
        order_id: ORDER_ID,
        order_status: 'pending_payment'
      });
      
      console.log('[GA4] ‚úÖ buy_intent sent via dataLayer:', {
        transaction_id: TRANSACTION_ID,
        order_id: ORDER_ID,
        value: total,
        items: ga4Items.length,
        status: 'pending_payment'
      });

      // ============================================
      // ‚úÖ REDDIT PIXEL EVENT: Lead (Buy Intent)
      // ============================================
      if (window.RedditPixel && typeof window.RedditPixel.trackBuyIntent === 'function') {
        window.RedditPixel.trackBuyIntent(ORDER_ID, total);
        console.log('[Reddit Pixel] ‚úÖ Buy Intent (Lead) event sent');
      } else {
        // Fallback: –ø—Ä—è–º–∞ —Ñ—É–Ω–∫—Ü—ñ—è rdt
        console.log('[Reddit Pixel] ‚è≥ Waiting for RedditPixel...');
        setTimeout(function() {
          if (window.RedditPixel && typeof window.RedditPixel.trackBuyIntent === 'function') {
            window.RedditPixel.trackBuyIntent(ORDER_ID, total);
            console.log('[Reddit Pixel] ‚úÖ Buy Intent (Lead) event sent (delayed)');
          } else if (typeof rdt !== 'undefined') {
            rdt('track', 'Lead', {
              'transactionId': ORDER_ID,
              'value': total,
              'currency': 'USD'
            });
            console.log('[Reddit Pixel] ‚úÖ Buy Intent (Lead) event sent (direct rdt)');
          } else {
            console.warn('[Reddit Pixel] ‚ö†Ô∏è Reddit Pixel not available');
          }
        }, 500);
      }

      // ============================================
      // ‚úÖ –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –î–õ–Ø ADMIN PANEL
      // ============================================
      try {
        const urlParams = new URLSearchParams(location.search);
        
        const existingKey = 'pending_order_' + ORDER_ID;
        const existing = localStorage.getItem(existingKey);
        
        if (existing) {
          console.log('[SUCCESS] ‚úÖ Pending order already exists, updating status');
          
          const existingData = JSON.parse(existing);
          existingData.success_page_visited = Date.now();
          existingData.status = 'pending_payment';
          existingData.buy_intent_sent = true;
          existingData.reddit_lead_sent = true;
          
          localStorage.setItem(existingKey, JSON.stringify(existingData));
          console.log('[SUCCESS] ‚úÖ Updated existing pending order:', ORDER_ID);
          
        } else {
          console.log('[SUCCESS] ‚ÑπÔ∏è Creating new pending order entry');
          
          const pendingOrder = {
            order_id: ORDER_ID,
            email: 'completed@checkout',
            timestamp: Date.now(),
            amount: total,
            subtotal: subtotal || total,
            discount: discount || 0,
            promo: promo || '',
            product: items.map(i => i.display || i.name).join(', '),
            items: items,
            utm_source: urlParams.get('utm_source') || 'direct',
            utm_campaign: urlParams.get('utm_campaign') || 'checkout_success',
            status: 'pending_payment',
            success_page_visited: Date.now(),
            buy_intent_sent: true,
            reddit_lead_sent: true
          };
          
          localStorage.setItem(existingKey, JSON.stringify(pendingOrder));
          console.log('[SUCCESS] ‚úÖ Created new pending order:', ORDER_ID);
        }
        
      } catch(e) {
        console.error('[SUCCESS] ‚ùå Cannot save pending order:', e);
      }
      
      // ============================================
      // ‚úÖ –û–ß–ò–©–ê–Ñ–ú–û _order_success_data
      // ============================================
      try {
        localStorage.removeItem('_order_success_data');
        console.log('[SUCCESS] üóëÔ∏è Cleared order data from localStorage');
      } catch(e) {
        console.warn('[SUCCESS] ‚ö†Ô∏è Cannot clear order data:', e);
      }
      
    } catch(e) {
      console.error('[SUCCESS] ‚ùå buy_intent error:', e);
    }
  }

  // ============================================
  // –í–ò–ö–û–ù–ê–ù–ù–Ø
  // ============================================
  console.log('[SUCCESS] ‚è≥ Waiting for page load...');
  
  if (document.readyState === 'complete') {
    console.log('[SUCCESS] ‚úÖ Page already loaded, sending buy_intent');
    setTimeout(sendBuyIntent, 1000);
  } else {
    window.addEventListener('load', function() {
      console.log('[SUCCESS] ‚úÖ Page loaded, sending buy_intent');
      setTimeout(sendBuyIntent, 1000);
    });
  }

})();
</script>

</body>
</html>
