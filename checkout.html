<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Checkout — ISRIB.shop</title>
  <meta name="description" content="Complete your order request. Research use only. Worldwide shipping.">

  <!-- Unified CSS -->
  <link rel="stylesheet" href="css/styles.css?v=11" />

  <!-- Page‑scoped cosmetics (мінімум) -->
  <style>
    .checkout-hero{
      background: linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);
      padding: 60px 0 50px; text-align:center; position:relative;
    }
    .checkout-hero::before{
      content:''; position:absolute; inset:0;
      background:
        radial-gradient(circle at 18% 82%, rgba(30,64,175,.10) 0%, transparent 50%),
        radial-gradient(circle at 84% 18%, rgba(14,165,233,.10) 0%, transparent 50%);
    }
    .checkout-hero .title{ position:relative; z-index:1; font-weight:900; font-size:clamp(2.2rem,4.5vw,3.4rem); color:#1e293b; margin:0 0 10px; }
    .checkout-hero .sub{ position:relative; z-index:1; color:#64748b; font-size:1.1rem; max-width:680px; margin:0 auto; }
  </style>
</head>
<body>

  <!-- Header (slim + sticky + burger) -->
<header class="header-slim site-header" id="siteHeader">
  <div class="container">
    <div class="header-content">
      <a href="/" class="logo-slim" aria-label="ISRIB.shop home">
        <img src="images/logo-dark-trimmed.png" alt="ISRIB.shop Logo" class="logo-image-slim"/>
      </a>

      <!-- Desktop nav -->
      <nav class="nav-slim" aria-label="Primary">
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
        <a href="checkout.html" class="cart-btn-slim" id="cartBtn">
          🧺 <span>Cart</span> <span id="cartCount" class="badge-slim">0</span>
        </a>
      </nav>

     <!-- Burger (mobile) -->
<button class="burger" id="burgerBtn"
        aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
  <svg class="burger-icon" width="22" height="22" viewBox="0 0 24 24"
       fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
    <path d="M4 7h16M4 12h16M10 17h10"/>
  </svg>
</button>



  <!-- Mobile menu -->
  <nav class="mobile-menu" id="mobileMenu" data-nav aria-label="Mobile">
    <a href="products.html" class="mm-link">Products</a>
    <a href="about.html" class="mm-link">About</a>
    <a href="faq.html" class="mm-link">FAQ</a>
    <a href="contact.html" class="mm-link">Contact</a>
    <a href="checkout.html" class="mm-link mm-cart">
      🧺 Cart <span id="cartCountMobile" class="mm-badge">0</span>
    </a>
  </nav>
</header>
  <!-- Page Header -->
  <section class="checkout-hero">
    <div class="container">
      <h1 class="title">Checkout</h1>
      <p class="sub">Fill the form below. We’ll confirm availability, shipping and payment details via email or messenger.</p>
    </div>
  </section>

  <!-- Checkout Content -->
  <main class="checkout-wrap">
    <div class="container">
      <div class="checkout-grid">
        <!-- LEFT: Form -->
        <form id="checkoutForm" class="card checkout-form" novalidate>
          <div class="card-body">
            <h2>Shipping & Contact</h2>

            <div class="form-two">
              <div class="form-group">
                <label for="firstName">First name<span class="req">*</span></label>
                <input id="firstName" name="firstName" autocomplete="given-name" required />
              </div>
              <div class="form-group">
                <label for="lastName">Last name<span class="req">*</span></label>
                <input id="lastName" name="lastName" autocomplete="family-name" required />
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email<span class="req">*</span></label>
              <input id="email" name="email" type="email" autocomplete="email" required />
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="country">Country<span class="req">*</span></label>
                <input id="country" name="country" autocomplete="country-name" required />
              </div>
              <div class="form-group">
                <label for="city">City<span class="req">*</span></label>
                <input id="city" name="city" autocomplete="address-level2" required />
              </div>
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="postal">Postal code<span class="req">*</span></label>
                <input id="postal" name="postal" autocomplete="postal-code" required />
              </div>
              <div class="form-group">
                <label for="address">Address<span class="req">*</span></label>
                <input id="address" name="address" autocomplete="address-line1" required />
              </div>
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="messenger">Preferred messenger (optional)</label>
                <select id="messenger" name="messenger">
                  <option value="">Select…</option>
                  <option>Telegram</option>
                  <option>Signal</option>
                  <option>WhatsApp</option>
                </select>
              </div>
              <div class="form-group">
                <label for="handle">Handle / phone (optional)</label>
                <input id="handle" name="handle" placeholder="@username or +1…" />
              </div>
            </div>

            <div class="form-group">
              <label for="notes">Notes (optional)</label>
              <textarea id="notes" name="notes" rows="3" placeholder="Institute / lab, delivery preferences, etc."></textarea>
            </div>

            <!-- honeypot -->
            <input type="text" name="_gotcha" class="hidden" aria-hidden="true" tabindex="-1" autocomplete="off"/>

            <label class="agree-row">
              <input type="checkbox" id="researchOnly" required />
              <span class="muted">
                I confirm the products are ordered strictly for <strong>research use only</strong>. Not for human consumption, clinical, or veterinary use.
                I agree to the <a class="link" href="terms.html">Terms</a>, <a class="link" href="privacy.html">Privacy Policy</a>, and <a class="link" href="disclaimer.html">Disclaimer</a>.
              </span>
            </label>

            <div class="form-actions">
              <button id="submitOrderBtn" class="btn btn-primary" type="submit">
               Submit Order Request
              </button>
              <div id="formMsg" class="form-status muted" role="status" aria-live="polite"></div>
            </div>
          </div>
        </form>

        <!-- RIGHT: Summary -->
        <aside class="card order-card">
          <div class="card-body">
            <h2>Order Summary</h2>

            <!-- список позицій -->
            <div id="cartList" class="cart-list"></div>

            <!-- підсумки -->
            <div id="summaryTotals" class="totals" aria-live="polite"></div>

            <hr class="sep" />
            <div class="pill">Research Use Only</div>
            <ul class="muted ro-list">
              <li>COA available per batch</li>
              <li>Worldwide shipping</li>
              <li>Secure packaging</li>
              <li>Support via Email/Telegram/Signal</li>
              <li>Payments arranged individually</li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ISRIB Shop</h3>
          <p>Advanced research chemicals for scientific advancement. Trusted by researchers worldwide for quality and reliability.</p>
          <p><strong>Email:</strong> isrib.shop@protonmail.com</p>
        </div>
        <div class="footer-section">
          <h3>Products</h3>
          <ul>
            <li><a href="product_isrib_A15.html">ISRIB-A15</a></li>
            <li><a href="product_isrib.html">ISRIB Original</a></li>
            <li><a href="product_zzl_7.html">ZZL-7</a></li>
            <li><a href="product_MPEP.html">MPEP Oxalate</a></li>
            <li><a href="products.html">All Products</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Information</h3>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="quality.html">Quality Control</a></li>
            <li><a href="safety.html">Safety Guidelines</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Legal</h3>
          <ul>
            <li><a href="terms.html">Terms of Service</a></li>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="research.html">Research Use Only</a></li>
            <li><a href="disclaimer.html">Disclaimer</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ISRIB Shop. All rights reserved. | Research chemicals for laboratory use only.</p>
      </div>
    </div>
  </footer>

  <!-- App JS -->
  <script src="js/main.js?v=8"></script>
      
      <script>
(function () {
  const form = document.getElementById('checkoutForm');
  const msgEl = document.getElementById('formMsg');
  const btn = document.getElementById('submitOrderBtn');

  function setMsg(text, type='') {
    msgEl.textContent = text;
    msgEl.classList.remove('error','success');
    if (type) msgEl.classList.add(type);
  }

  function getCartItems() {
    // Підлаштовуємось під різні ключі/структури
    const keys = ['cart', 'cartItems', 'isrib_cart'];
    for (const k of keys) {
      try {
        const raw = localStorage.getItem(k);
        if (!raw) continue;
        const val = JSON.parse(raw);
        if (Array.isArray(val) && val.length) return val;
        if (val && Array.isArray(val.items)) return val.items;
      } catch(_) {}
    }
    // fallback: спроба зібрати з DOM, якщо main.js вже намалював список
    const list = document.querySelectorAll('#cartList [data-item]');
    if (list.length) {
      return Array.from(list).map(node => ({
        id:    node.getAttribute('data-id') || '',
        name:  node.getAttribute('data-name') || node.querySelector('.title')?.textContent?.trim() || 'item',
        qty:   Number(node.getAttribute('data-qty') || node.querySelector('[data-qty]')?.textContent || 1),
        price: Number(node.getAttribute('data-price') || node.querySelector('[data-price]')?.textContent || 0)
      }));
    }
    return [];
  }

  function calcTotal(items){
    return items.reduce((s, it) => {
      const qty = Number(it.qty ?? it.quantity ?? 1);
      const price = Number(it.price ?? 0);
      return s + qty * price;
    }, 0);
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    setMsg('', '');
    btn.disabled = true;

    const fd = new FormData(form);

    // honeypot: _gotcha у формі
    if (fd.get('_gotcha')) { btn.disabled = false; return; }

    // валідація мінімум
    const required = ['firstName','lastName','email','country','city','postal','address'];
    for (const r of required) {
      if (!fd.get(r)) {
        setMsg('Please fill all required fields.', 'error');
        btn.disabled = false;
        return;
      }
    }

    const items = getCartItems();
    const total = calcTotal(items);

    const payload = {
      firstName: fd.get('firstName') || '',
      lastName:  fd.get('lastName')  || '',
      email:     fd.get('email')     || '',
      country:   fd.get('country')   || '',
      city:      fd.get('city')      || '',
      postal:    fd.get('postal')    || '',
      address:   fd.get('address')   || '',
      messenger: fd.get('messenger') || '',
      handle:    fd.get('handle')    || '',
      notes:     fd.get('notes')     || '',
      _gotcha:   fd.get('_gotcha')   || '',
      items,
      total
    };

    try {
      const res = await fetch('/api/checkout', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if (res.ok) {
  window.location.href = '/success.html';
      }
      else {
        setMsg('Error: ' + (data.error || 'Failed to send request.'), 'error');
      }
    } catch (err) {
      setMsg('Network error. Please try again.', 'error');
    } finally {
      btn.disabled = false;
    }
  });
})();
</script>

  <script>
    // рік у футері (без залежностей)
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
