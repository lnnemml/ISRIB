<!doctype html>
<html lang="en">
<head>

  <script src="/scripts/gtm.js" async></script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Checkout ‚Äî ISRIB.shop</title>
  <meta name="description" content="Complete your order request. Research use only. Worldwide shipping.">
  <!-- Favicon & App Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/images/site.webmanifest">
<link rel="shortcut icon" href="/images/favicon.ico">
<meta name="theme-color" content="#ffffff">

  <!-- Unified CSS -->
  <link rel="stylesheet" href="css/styles.css?v=11" />

  <!-- Page‚Äëscoped cosmetics (–º—ñ–Ω—ñ–º—É–º) -->
  <style>
    .checkout-hero{
      background: linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);
      padding: 60px 0 50px; text-align:center; position:relative;
    }
    .checkout-hero::before{
      content:''; position:absolute; inset:0;
      background:
        radial-gradient(circle at 18% 82%, rgba(30,64,175,.10) 0%, transparent 50%),
        radial-gradient(circle at 84% 18%, rgba(14,165,233,.10) 0%, transparent 50%);
    }
    .checkout-hero .title{ position:relative; z-index:1; font-weight:900; font-size:clamp(2.2rem,4.5vw,3.4rem); color:#1e293b; margin:0 0 10px; }
    .checkout-hero .sub{ position:relative; z-index:1; color:#64748b; font-size:1.1rem; max-width:680px; margin:0 auto; }
  </style>
</head>
<body>

  <!-- Header (slim + sticky + burger) -->
<header class="header-slim site-header" id="siteHeader">
  <div class="container">
    <div class="header-content">
      <a href="/" class="logo-slim" aria-label="ISRIB.shop home">
        <img src="images/logo-dark-trimmed.png" alt="ISRIB.shop Logo" class="logo-image-slim"/>
      </a>

      <!-- Desktop nav -->
      <nav class="nav-slim" aria-label="Primary">
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
        <a href="checkout.html" class="cart-btn-slim" id="cartBtn">
          üß∫ <span>Cart</span> <span id="cartCount" class="badge-slim">0</span>
        </a>
      </nav>

     <!-- Burger (mobile) -->
<button class="burger" id="burgerBtn"
        aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
  <svg class="burger-icon" width="22" height="22" viewBox="0 0 24 24"
       fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
    <path d="M4 7h16M4 12h16M10 17h10"/>
  </svg>
</button>

  <!-- Mobile menu -->
  <nav class="mobile-menu" id="mobileMenu" data-nav aria-label="Mobile">
    <a href="products.html" class="mm-link">Products</a>
    <a href="about.html" class="mm-link">About</a>
    <a href="faq.html" class="mm-link">FAQ</a>
    <a href="contact.html" class="mm-link">Contact</a>
    <a href="checkout.html" class="mm-link mm-cart">
      üß∫ Cart <span id="cartCountMobile" class="mm-badge">0</span>
    </a>
  </nav>
</header>

  <!-- Page Header -->
  <section class="checkout-hero">
    <div class="container">
      <h1 class="title">Checkout</h1>
      <p class="sub">Fill the form below. We'll confirm availability, shipping and payment details via email or messenger.</p>
      
      <div class="free-shipping-banner">
        <span class="emoji">üöö</span>
        <strong>Free Worldwide Shipping</strong>
        <span>on all orders ‚Äî limited-time launch offer</span>
      </div>
      
      <!-- Progress bar -->
      <div style="max-width:800px;margin:0 auto 32px;padding:0 20px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <span style="color:#10b981;font-weight:600;">‚úì Cart</span>
          <span style="color:#3b82f6;font-weight:600;">‚Üí Shipping</span>
          <span style="color:#94a3b8;">‚úì Complete</span>
        </div>
        <div style="height:4px;background:#e5e7eb;border-radius:2px;">
          <div style="width:66%;height:100%;background:#3b82f6;border-radius:2px;"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Checkout Content -->
  <main class="checkout-wrap">
    <div class="container">
      <div class="checkout-grid">
        <!-- LEFT: Form -->
        <form id="checkoutForm" class="card checkout-form" novalidate>
          <div class="card-body">
            <h2>Shipping & Contact</h2>

            <div class="form-two">
              <div class="form-group">
                <label for="firstName">First name<span class="req">*</span></label>
                <input id="firstName" name="firstName" autocomplete="given-name" required />
              </div>
              <div class="form-group">
                <label for="lastName">Last name<span class="req">*</span></label>
                <input id="lastName" name="lastName" autocomplete="family-name" required />
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email<span class="req">*</span></label>
              <input id="email" name="email" type="email" autocomplete="email" required />
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="country">Country<span class="req">*</span></label>
                <input id="country" name="country" autocomplete="country-name" required />
              </div>
              <div class="form-group">
                <label for="region">Region/State</label>
                <input id="region" name="region" autocomplete="address-level1" />
              </div>
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="city">City<span class="req">*</span></label>
                <input id="city" name="city" autocomplete="address-level2" required />
              </div>
              <div class="form-group">
                <label for="postal">Postal code<span class="req">*</span></label>
                <input id="postal" name="postal" autocomplete="postal-code" required />
              </div>
            </div>

            <div class="form-two">
              <div class="form-group full">
                <label for="address">Address<span class="req">*</span></label>
                <input id="address" name="address" autocomplete="address-line1" required />
              </div>
            </div>

            <div class="form-two">
              <div class="form-group">
                <label for="messenger">Preferred messenger (optional)</label>
                <select id="messenger" name="messenger">
                  <option value="">Select‚Ä¶</option>
                  <option>Telegram</option>
                  <option>Signal</option>
                  <option>WhatsApp</option>
                </select>
              </div>
              <div class="form-group">
                <label for="handle">Handle / phone (optional)</label>
                <input id="handle" name="handle" placeholder="@username or +1‚Ä¶" />
              </div>
            </div>

            <div class="form-group">
              <label for="notes">Notes (optional)</label>
              <textarea id="notes" name="notes" rows="3" placeholder="Institute / lab, delivery preferences, etc."></textarea>
            </div>

            <!-- honeypot -->
            <input type="text" name="_gotcha" class="hidden" aria-hidden="true" tabindex="-1" autocomplete="off"/>

            <label class="agree-row">
              <input type="checkbox" id="researchOnly" required />
              <span class="muted">
                I confirm the products are ordered strictly for <strong>research use only</strong>. Not for human consumption, clinical, or veterinary use.
                I agree to the <a class="link" href="terms.html">Terms</a>, <a class="link" href="privacy.html">Privacy Policy</a>, and <a class="link" href="disclaimer.html">Disclaimer</a>.
              </span>
            </label>

            <div class="form-actions">
              <button id="submitOrderBtn" class="btn btn-primary" type="submit">
                Submit Order Request
              </button>
              <div id="formMsg" class="form-status muted" role="status" aria-live="polite"></div>
            </div>
          </div>
        </form>

        <!-- RIGHT: Summary -->
        <aside class="card order-card">
          <div class="card-body">
            <h2>Order Summary</h2>

            <!-- —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü—ñ–π -->
            <div id="cartList" class="cart-list"></div>
            
            <!-- Promo code -->
            <div class="promo-section" style="margin:20px 0;">
              <div class="form-group">
                <label for="promoCode">Promo code (optional)</label>
                <div style="display:flex;gap:8px;">
                  <input 
                    type="text" 
                    id="promoCode" 
                    name="promoCode" 
                    placeholder="Enter code" 
                    style="flex:1;text-transform:uppercase;padding-left:14px;padding-right:14px;"
                    autocomplete="off"
                  />
                  <button 
                    type="button" 
                    id="applyPromoBtn" 
                    class="btn btn-outline"
                    style="white-space:nowrap;"
                  >
                    Apply
                  </button>
                </div>
                <div id="promoMsg" style="margin-top:8px;font-size:13px;"></div>
              </div>
            </div>
            
            <!-- –ø—ñ–¥—Å—É–º–∫–∏ -->
            <div id="summaryTotals" class="totals" aria-live="polite"></div>

            <hr class="sep" />

            <!-- Upsell Widget (–¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç) -->
            <div class="card upsell-widget" id="checkoutUpsell">
              <div class="card-body">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ initCheckoutUpsell() -->
              </div>
            </div>
            
            <div class="pill">Research Use Only</div>
            <ul class="muted ro-list">
              <li>COA available per batch</li>
              <li>Worldwide shipping</li>
              <li>Secure packaging</li>
              <li>Support via Email/Telegram/Signal</li>
              <li>Payments arranged individually</li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ISRIB Shop</h3>
          <p>Advanced research chemicals for scientific advancement. Trusted by researchers worldwide for quality and reliability.</p>
          <p><strong>Email:</strong> isrib.shop@protonmail.com</p>
        </div>
        <div class="footer-section">
          <h3>Products</h3>
          <ul>
            <li><a href="product_isrib_A15.html">ISRIB-A15</a></li>
            <li><a href="product_isrib.html">ISRIB Original</a></li>
            <li><a href="product_zzl_7.html">ZZL-7</a></li>
            <li><a href="product_MPEP.html">MPEP Oxalate</a></li>
            <li><a href="products.html">All Products</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Information</h3>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="quality.html">Quality Control</a></li>
            <li><a href="safety.html">Safety Guidelines</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Legal</h3>
          <ul>
            <li><a href="terms.html">Terms of Service</a></li>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="research.html">Research Use Only</a></li>
            <li><a href="disclaimer.html">Disclaimer</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ISRIB Shop. All rights reserved. | Research chemicals for laboratory use only.</p>
      </div>
    </div>
  </footer>

  <!-- App JS -->
  <script src="js/main.js?v=34"></script>

  <!-- ============================================ -->
  <!-- BEGIN_CHECKOUT EVENT (–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û)     -->
  <!-- ============================================ -->
  <script>
(function() {
  // ============================================
  // ‚úÖ –§–£–ù–ö–¶–Ü–Ø –î–õ–Ø –û–¢–†–ò–ú–ê–ù–ù–Ø –ê–ë–û –ì–ï–ù–ï–†–ê–¶–Ü–á ORDER ID
  // ============================================
  function getOrCreateOrderId() {
    const SESSION_KEY = '_order_id';
    const TIMESTAMP_KEY = '_order_timestamp';
    const MAX_AGE = 30 * 60 * 1000; // 30 —Ö–≤–∏–ª–∏–Ω
    
    try {
      // 1. –°–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ sessionStorage
      const stored = sessionStorage.getItem(SESSION_KEY);
      const timestamp = parseInt(sessionStorage.getItem(TIMESTAMP_KEY) || '0');
      
      if (stored && (Date.now() - timestamp) < MAX_AGE) {
        console.log('[CHECKOUT] ‚ôªÔ∏è Reusing existing Order ID:', stored);
        return stored;
      }
      
      // 2. –°–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ _checkout_data
      const checkoutData = sessionStorage.getItem('_checkout_data');
      if (checkoutData) {
        try {
          const parsed = JSON.parse(checkoutData);
          if (parsed.order_id) {
            console.log('[CHECKOUT] üìã Found Order ID in checkout data:', parsed.order_id);
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É
            sessionStorage.setItem(SESSION_KEY, parsed.order_id);
            sessionStorage.setItem(TIMESTAMP_KEY, Date.now().toString());
            return parsed.order_id;
          }
        } catch(e) {}
      }
      
      // 3. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î pending order –≤ localStorage
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('pending_order_')) {
          try {
            const orderData = JSON.parse(localStorage.getItem(key) || '{}');
            if (orderData.email === 'pending@direct-buy' && orderData.order_id) {
              console.log('[CHECKOUT] üîÑ Found pending order from direct buy:', orderData.order_id);
              // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
              sessionStorage.setItem(SESSION_KEY, orderData.order_id);
              sessionStorage.setItem(TIMESTAMP_KEY, Date.now().toString());
              return orderData.order_id;
            }
          } catch(e) {}
        }
      }
      
    } catch(e) {
      console.warn('[CHECKOUT] ‚ö†Ô∏è Error checking existing Order ID:', e);
    }
    
    // 4. –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ - –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–∏–π
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(2, 9).toUpperCase();
    const orderId = `ORD-${timestamp}-${random}`;
    
    try {
      sessionStorage.setItem(SESSION_KEY, orderId);
      sessionStorage.setItem(TIMESTAMP_KEY, timestamp.toString());
      console.log('[CHECKOUT] ‚ú® Created new Order ID:', orderId);
    } catch(e) {
      console.warn('[CHECKOUT] ‚ö†Ô∏è Cannot save Order ID to sessionStorage');
    }
    
    return orderId;
  }
  
  // –ì–µ–Ω–µ—Ä—É—î–º–æ Order ID –û–î–†–ê–ó–£ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ checkout
  const orderId = getOrCreateOrderId();
  
  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ main.js
  window._generatedOrderId = orderId;
  
  console.log('[CHECKOUT] üÜî Active Order ID:', orderId);
  
  // ============================================
  // ‚úÖ –û–ù–û–í–õ–Æ–Ñ–ú–û PENDING ORDER –Ø–ö–©–û –ü–û–¢–†–Ü–ë–ù–û
  // ============================================
  try {
    const pendingKey = 'pending_order_' + orderId;
    const existingOrder = localStorage.getItem(pendingKey);
    
    if (existingOrder) {
      const orderData = JSON.parse(existingOrder);
      console.log('[CHECKOUT] üì¶ Found existing pending order:', orderData);
      
      // –Ø–∫—â–æ —Ü–µ order –∑ direct buy (–±–µ–∑ email), –æ–Ω–æ–≤–∏–º–æ timestamp
      if (orderData.email === 'pending@direct-buy') {
        orderData.checkout_opened_at = Date.now();
        localStorage.setItem(pendingKey, JSON.stringify(orderData));
        console.log('[CHECKOUT] üîÑ Updated pending order timestamp');
      }
    } else {
      console.log('[CHECKOUT] ‚ÑπÔ∏è No existing pending order found (will be created on submit)');
    }
  } catch(e) {
    console.error('[CHECKOUT] ‚ùå Error updating pending order:', e);
  }
})();
</script>


  <!-- ============================================ -->
  <!-- –ì–ï–ù–ï–†–ê–¶–Ü–Ø ORDER ID –ù–ê –§–†–û–ù–¢–ï–ù–î–Ü             -->
  <!-- ============================================ -->
  <script>
(function() {
  // –ì–µ–Ω–µ—Ä—É—î–º–æ Order ID –û–î–†–ê–ó–£ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ checkout
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 9).toUpperCase();
  const orderId = `ORD-${timestamp}-${random}`;
  
  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω–æ
  window._generatedOrderId = orderId;
  
  console.log('[CHECKOUT] üÜî Pre-generated Order ID:', orderId);
})();
  </script>


      <!-- ============================================ -->
<!-- DEBUG –°–ö–†–ò–ü–¢ –î–õ–Ø –ü–ï–†–ï–í–Ü–†–ö–ò ORDER ID FLOW     -->
<!-- –î–æ–¥–∞–π—Ç–µ –≤ –∫—ñ–Ω–µ—Ü—å checkout.html –ø–µ—Ä–µ–¥ </body> -->
<!-- ============================================ -->
<script>
// Debug: –ü–æ–∫–∞–∑—É—î–º–æ –≤—Å—ñ Order ID –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö
console.log('');
console.log('=== üîç ORDER ID DEBUG ===');
console.log('');

// 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ sessionStorage
console.log('üìã SessionStorage:');
console.log('  _order_id:', sessionStorage.getItem('_order_id'));
console.log('  _order_timestamp:', sessionStorage.getItem('_order_timestamp'));

const checkoutData = sessionStorage.getItem('_checkout_data');
if (checkoutData) {
  try {
    const parsed = JSON.parse(checkoutData);
    console.log('  _checkout_data.order_id:', parsed.order_id);
    console.log('  _checkout_data.transaction_id:', parsed.transaction_id);
  } catch(e) {
    console.log('  _checkout_data: ‚ùå Invalid JSON');
  }
} else {
  console.log('  _checkout_data: ‚ö†Ô∏è Not found');
}

// 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É
console.log('');
console.log('üåê Global Variable:');
console.log('  window._generatedOrderId:', window._generatedOrderId);

// 3. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ localStorage pending orders
console.log('');
console.log('üíæ LocalStorage Pending Orders:');
let foundPending = false;
for (let i = 0; i < localStorage.length; i++) {
  const key = localStorage.key(i);
  if (key && key.startsWith('pending_order_')) {
    foundPending = true;
    try {
      const order = JSON.parse(localStorage.getItem(key) || '{}');
      console.log('  ‚úì', key);
      console.log('    - order_id:', order.order_id);
      console.log('    - email:', order.email);
      console.log('    - amount:', order.amount);
      console.log('    - product:', order.product);
      console.log('    - timestamp:', new Date(order.timestamp).toLocaleString());
    } catch(e) {
      console.log('  ‚úó', key, '‚ùå Invalid JSON');
    }
  }
}
if (!foundPending) {
  console.log('  ‚ö†Ô∏è No pending orders found');
}

// 4. –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ—à–∏–∫
console.log('');
console.log('üõí Cart:');
try {
  const cart = JSON.parse(localStorage.getItem('isrib_cart') || '[]');
  console.log('  Items:', cart.length);
  cart.forEach((item, idx) => {
    console.log(`  ${idx + 1}. ${item.name} - ${item.display} √ó ${item.count} = $${item.price * item.count}`);
  });
} catch(e) {
  console.log('  ‚ùå Error reading cart');
}

console.log('');
console.log('=== END DEBUG ===');
console.log('');

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—å–æ–≥–æ
window.debugClearAll = function() {
  console.log('üßπ Clearing all data...');
  
  // –û—á–∏—â–∞—î–º–æ sessionStorage
  sessionStorage.removeItem('_order_id');
  sessionStorage.removeItem('_order_timestamp');
  sessionStorage.removeItem('_checkout_data');
  sessionStorage.removeItem('_txn_id');
  sessionStorage.removeItem('_txn_timestamp');
  
  // –û—á–∏—â–∞—î–º–æ pending orders
  const keys = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && key.startsWith('pending_order_')) {
      keys.push(key);
    }
  }
  keys.forEach(key => localStorage.removeItem(key));
  
  console.log('‚úÖ Cleared:');
  console.log('  - sessionStorage Order ID');
  console.log('  - sessionStorage Transaction ID');
  console.log('  - sessionStorage Checkout Data');
  console.log('  - localStorage Pending Orders:', keys.length);
  console.log('');
  console.log('‚ö†Ô∏è Note: Cart was NOT cleared');
  console.log('Run location.reload() to refresh');
};

console.log('üí° Tip: Run debugClearAll() to reset everything');
</script>
</body>
</html>
